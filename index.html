<!DOCTYPE html>
<html>

<head>
    <title>RC카</title>
    <script src="blockly_compressed.js"></script>
    <script src="blocks_compressed.js"></script>
    <script src="javascript_compressed.js"></script>
    <script src="msg/ko.js"></script>
    <script src="block.js"></script>
    <link href="css.css" rel="stylesheet" type="text/css">
    <style>
        #box {
            position: relative;
        }
    </style>
</head>

<body>
    <h1>RC카</h1>
    <div>
        <div id="sim">
            <div id="carsim">
                <div id="box">
                    <div id="path" class="path"></div>
                </div>
            </div>
            <div class="btnbox">
                <button onclick="runCode()" class="startbtn">코드 실행</button>
                <button onclick="reset()" class="startbtn">초기화</button>
            </div>
            <div id="outputContainer">
                <label>자바스크립트 코드</label>
                <div id="outputbox">
                    <pre id="output"></pre>
                </div>
            </div>
        </div>
    </div>
    <div id="blocklyDiv" style="height: 600px; width: 800px; float: left;"></div>
    <xml id="toolbox" style="display: none">
        <category name="기본 블록" colour="#5C81A6">
            <block type="controls_repeat"></block>
        </category>
        <category name="RC카 블록" colour="#FF7F27">
            <block type="cfront"></block>
            <block type="cback"></block>
            <block type="crot"></block>
            <block type="crot2"></block>
            <block type="ccolor"></block>
        </category>
    </xml>
    <script>
        var box = document.getElementById('box');
        let goal;
        let count;

        var workspace = Blockly.inject('blocklyDiv', {
            toolbox: document.getElementById('toolbox'),
            trashcan: true
        });

        function runCode() {
            var code = Blockly.JavaScript.workspaceToCode(workspace);
            document.getElementById('output').textContent = code;

            try {
                reset();
                eval(code);
            } catch (error) {
                console.error("에러 코드:", error);
                alert("에러 코드:" + error);
            }
        }

        const mapArray = [
            [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
            [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
            [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
            [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
            [1, 1, 1, 2, 1, 3, 1, 1, 1, 1, 1],
            [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
            [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
            [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
            [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
            [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
            [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]
        ];

        let x = 3;
        let y = 5;
        let direction = 'right'; // 초기 방향은 오른쪽

        function reset() {
            mapArray.length = 0; // 배열 비우기
            mapArray.push(
                [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
                [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
                [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
                [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
                [1, 1, 1, 2, 1, 3, 1, 1, 1, 1, 1],
                [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
                [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
                [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
                [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
                [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
                [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]
            );
            x = 4;
            y = 5;
            direction = 'right';
            displayMap(mapArray);
        }

        function walk() {
            mapArray[y - 1][x - 1] = 0;

            // 이동 로직
            if (direction === 'right' && x < mapArray[0].length) {
                x += 1;
            } else if (direction === 'left' && x > 1) {
                x -= 1;
            } else if (direction === 'up' && y > 1) {
                y -= 1;
            } else if (direction === 'down' && y < mapArray.length) {
                y += 1;
            }
            goal = mapArray[y - 1][x - 1];
            mapArray[y - 1][x - 1] = 2;

            displayMap(mapArray);
            if (goal == 3) {
                setTimeout(() => {
                    alert("통과");
                    goal = 1;

                }, 1000);
            }
        }

        function walk2() {
            mapArray[y - 1][x - 1] = 0;

            // 이동 로직
            if (direction === 'right' && x > 1) {
                x -= 1;
            } else if (direction === 'left' && x < mapArray[0].length) {
                x += 1;
            } else if (direction === 'up' && y < mapArray.length) {
                y += 1;
            } else if (direction === 'down' && y > 1) {
                y -= 1;
            }

            mapArray[y - 1][x - 1] = 2;

            displayMap(mapArray);
            if (goal == 3) {
                setTimeout(() => {
                    alert("통과");
                    goal = 1;

                }, 1000);
            }

        }

        function turnRight() {
            if (direction === 'up') {
                direction = 'right';
            } else if (direction === 'right') {
                direction = 'down';
            } else if (direction === 'down') {
                direction = 'left';
            } else if (direction === 'left') {
                direction = 'up';
            }
        }

        function turnLeft() {
            if (direction === 'up') {
                direction = 'left';
            } else if (direction === 'left') {
                direction = 'down';
            } else if (direction === 'down') {
                direction = 'right';
            } else if (direction === 'right') {
                direction = 'up';
            }
        }


        function displayMap(map) {
            const container = document.createElement('div');

            for (let i = 0; i < map.length; i++) {
                for (let j = 0; j < map[i].length; j++) {
                    const cell = document.createElement('div');
                    cell.classList.add('cell', `cell-${map[i][j]}`);
                    container.appendChild(cell);
                }
                container.appendChild(document.createElement('br')); // 줄 바꿈 추가
            }

            box.innerHTML = ''; // Clear previous content
            box.appendChild(container);
        }


        displayMap(mapArray);
    </script>

</body>

</html>